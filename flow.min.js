var flow=function(){function e(e){"use strict";if(!e)return this;this.xhr=null,this.values=e;var t=this;return t.Events=function(){this.events=[]},t.Events.prototype.on=function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)},t.Events.prototype.off=function(e){this.events[e]=[],delete this.events[e]},t.Events.prototype.fire=function(e,r){this.events[e]&&this.events[e].forEach(function(s){s.apply(t,[e,r])})},t.Listener=new t.Events,t.timer={start:0,stop:0,diff:0},t.result=!1,t.then=function(e){return t.Listener.on("success",function(r,s){t.timer.stop=(new Date).getTime(),t.timer.diff=t.timer.stop-t.timer.start,"function"==typeof e&&e.apply(t,s),t.Listener.off("reject"),t.Listener.off("success"),t.Listener.off("progress")}),t},t.progress=function(e){return t.Listener.on("progress",function(r,s){t.timer.stop=(new Date).getTime(),t.timer.diff=t.timer.stop-t.timer.start,"function"==typeof e&&e.apply(t,s)}),t},t.reject=function(e){return t.Listener.on("reject",function(r,s){t.timer.stop=(new Date).getTime(),t.timer.diff=t.timer.stop-t.timer.start,"function"==typeof e&&e.apply(t,s),t.Listener.off("reject"),t.Listener.off("success"),t.Listener.off("progress")}),t},t}function t(e){try{return""+Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}catch(e){return""}}e.prototype={values:{method:"POST",url:null,data:null,timeout:2e3,headers:"x-flow-request"},timer:{start:0,stop:0,diff:0},header:function(e){if(null!==e)for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];null!==this.xhr&&this.xhr.setRequestHeader(t,r)}}},e.prototype.progressing={value:null,max:null},e.prototype.ajax=function(){var e=this;try{var s=new Array("Msxml2.XMLHTTP.7.0","Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.5.0","Msxml2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP");if(window.XMLHttpRequest)e.xhr=new XMLHttpRequest;else for(var i=!1,n=0;n<s.length&&!i;n++)try{e.xhr=new ActiveXObject(s[n]),i=!0}catch(t){return e.Listener.fire("reject",[605,e.xhr.status,e.xhr]),e.xhr=null,e}if(null!==e.xhr){e.timer.start=(new Date).getTime(),e.xhr.open(e.values.method,e.values.url,!0),e.xhr.withCredentials=!0;var o="application/x-www-form-urlencoded";e.xhr.setRequestHeader("Content-type",o),e.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.xhr.overrideMimeType&&e.xhr.overrideMimeType("text/plain;charset=UTF-8"),vars=null==e.values.data?null:t(e.values.data),e.xhr.timeout=e.values.timeout,e.xhr.onreadystatechange=function(){r(e)},e.xhr.ontimeout=function(t){e.timer.stop=(new Date).getTime(),e.timer.diff=e.timer.stop-e.timer.start,e.Listener.fire("reject",[408,e.xhr.status,e.xhr]),e.xhr.abort()},e.xhr.onerror=function(t){e.Listener.fire("reject",[604,e.xhr.status,e.xhr]),e.xhr.abort()},setTimeout(function(){"post"==e.values.method.toLowerCase()?e.xhr.send(vars):e.xhr.send()},10)}}catch(t){e.timer.stop=(new Date).getTime(),e.timer.diff=e.timer.stop-e.timer.start,e.Listener.fire("reject",[606,e.xhr.status,e.xhr]),e.xhr=null}return e},e.prototype.cors=function(){var e=this;try{try{e.xhr=new XMLHttpRequest(e.values.method,e.values.url),"withCredentials"in e.xhr?e.xhr.open(e.values.method,e.values.url,!0):"undefined"!=typeof XDomainRequest?(e.xhr=new XDomainRequest,this.xhr.open(e.values.method,e.values.url)):(e.Listener.fire("reject",[609,0,e.xhr]),e.xhr=null)}catch(t){e.Listener.fire("reject",[605,0,e.xhr]),e.xhr=null}if(null!==e.xhr){e.timer.start=(new Date).getTime(),e.xhr.withCredentials=!0;var s="application/x-www-form-urlencoded";e.xhr.setRequestHeader("Content-type",s),e.xhr.overrideMimeType&&e.xhr.overrideMimeType("text/plain;charset=UTF-8"),vars=null==e.values.data?null:t(e.values.data),e.xhr.timeout=e.values.timeout,e.xhr.onreadystatechange=function(){r(e)},e.xhr.ontimeout=function(t){e.timer.stop=(new Date).getTime(),e.timer.diff=e.timer.stop-e.timer.start,e.Listener.fire("reject",[408,e.xhr.status,e.xhr]),e.xhr.abort()},e.xhr.onerror=function(t){e.Listener.fire("reject",[604,e.xhr.status,e.xhr]),e.xhr.abort()},setTimeout(function(){"post"==e.values.method.toLowerCase()?e.xhr.send(vars):e.xhr.send()},10)}}catch(t){e.timer.stop=(new Date).getTime(),e.timer.diff=e.timer.stop-e.timer.start,e.Listener.fire("reject",[606,e.xhr.status,e.xhr]),e.xhr=null}return e};var r=function(e){if([200,301,302,303,307].indexOf(e.xhr.status)>-1)switch(e.xhr.readyState){case 0:e.timer.stop=(new Date).getTime(),e.timer.diff=e.timer.stop-e.timer.start,e.Listener.fire("reject",[604,e.xhr.status,e.xhr]);break;case 1:e.Listener.fire("progress",[e.xhr.status,e.xhr]);case 2:e.Listener.fire("progress",[e.xhr.status,e.xhr]);case 3:e.Listener.fire("progress",[e.xhr.status,e.xhr]);break;case 4:var t=e.xhr.responseText;e.timer.stop=(new Date).getTime(),e.timer.diff=e.timer.stop-e.timer.start,e.Listener.fire("success",[t,e.xhr.status,e.xhr]);break;default:e.timer.stop=(new Date).getTime(),e.timer.diff=e.timer.stop-e.timer.start,e.Listener.fire("reject",[601,e.xhr.status,e.xhr])}else switch(e.xhr.readyState){case 0:e.timer.stop=(new Date).getTime(),e.timer.diff=e.timer.stop-e.timer.start,e.Listener.fire("reject",[604,e.xhr.status,e.xhr]);break;case 1:e.Listener.fire("progress",[e.xhr.status,e.xhr]);case 2:e.Listener.fire("progress",[e.xhr.status,e.xhr]);case 3:e.Listener.fire("progress",[e.xhr.status,e.xhr]);break;case 4:e.timer.stop=(new Date).getTime(),e.timer.diff=e.timer.stop-e.timer.start,e.Listener.fire("reject",[e.xhr.status,e.xhr.status,e.xhr]);break;default:e.timer.stop=(new Date).getTime(),e.timer.diff=e.timer.stop-e.timer.start,e.Listener.fire("reject",[601,e.xhr.status,e.xhr])}};return e.prototype.buildQuery=t,e.prototype.getQuery=function(e){var t={};return t=e.split("?"),t.hasOwnProperty(1)?t[1]:null},e.prototype.parseQuery=function(e){var t={},r={};r=e.split("&");for(var s in r)if(r.hasOwnProperty(s)){var i=r[s].split("=");t[i[0]]=void 0!=i[1]?i[1]:null}return t},e.prototype.noCache=function(e){return null==e&&(e="?"),e+"nocache="+(new Date).getTime()},e.prototype.online=function(){return!!navigator.onLine},"undefined"!=typeof y&&(y.prototype.flow=e,y.fn.flow=e),"function"==typeof include&&(include.prototype.fn.flow=e),"function"==typeof define&&define.amd?void define(function(){return e}):e}();